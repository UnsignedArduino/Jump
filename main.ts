namespace SpriteKind {
    export const MovingPlatform = SpriteKind.create()
}
scene.onHitWall(SpriteKind.Player, function (sprite, location) {
    if (sprite.isHittingTile(CollisionDirection.Bottom)) {
        jumps_made = 0
    }
})
function make_platform (left: number, width: number, height: number) {
    for (let index = 0; index <= width - 1; index++) {
        tiles.setTileAt(tiles.getTileLocation(left + index, height), myTiles.tile1)
        tiles.setWallAt(tiles.getTileLocation(left + index, height), true)
    }
}
controller.A.onEvent(ControllerButtonEvent.Pressed, function () {
    if (jumps_made < constants_jumps_max) {
        jump(sprite_player, constants_gravity, 32)
        jumps_made += 1
    }
})
function clear_map () {
    tiles.setSmallTilemap(tiles.createTilemap(hex`14003c00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000`, img`
        ....................
        ....................
        ....................
        ....................
        ....................
        ....................
        ....................
        ....................
        ....................
        ....................
        ....................
        ....................
        ....................
        ....................
        ....................
        ....................
        ....................
        ....................
        ....................
        ....................
        ....................
        ....................
        ....................
        ....................
        ....................
        ....................
        ....................
        ....................
        ....................
        ....................
        ....................
        ....................
        ....................
        ....................
        ....................
        ....................
        ....................
        ....................
        ....................
        ....................
        ....................
        ....................
        ....................
        ....................
        ....................
        ....................
        ....................
        ....................
        ....................
        ....................
        ....................
        ....................
        ....................
        ....................
        ....................
        ....................
        ....................
        ....................
        ....................
        ....................
        `, [myTiles.transparency8], TileScale.Eight))
    for (let value of sprites.allOfKind(SpriteKind.MovingPlatform)) {
        value.destroy()
    }
}
function jump (sprite: Sprite, gravity: number, pixels: number) {
    sprite.vy = Math.sqrt(2 * (gravity * pixels)) * -1
}
function make_map (num_platforms: number, width: number, start_y: number) {
    for (let index = 0; index <= num_platforms - 1; index++) {
        make_random(randint(0, 20 - width), width, 60 - (index * 3 + start_y))
    }
}
function make_random (left: number, width: number, height: number) {
    local_random = randint(0, 100)
    if (local_random < 50) {
        make_platform(left, width, height)
    } else if (local_random < 75) {
        make_platform(left, width, height)
    } else {
        make_platform(left, width, height)
    }
}
function animate_player (sprite: Sprite) {
    character.loopFrames(
    sprite,
    [img`
        . 8 8 8 8 8 . . 
        8 8 8 8 8 8 8 . 
        . f 6 f 6 6 . . 
        . 6 6 6 6 6 . . 
        . 6 6 f 6 6 . . 
        . 6 6 6 6 6 . . 
        . . . . . 6 . . 
        . . . . . 6 . . 
        `,img`
        . 8 8 8 8 8 . . 
        8 8 8 8 8 8 8 . 
        . f 6 f 6 6 . . 
        . 6 6 6 6 6 . . 
        . 6 6 f 6 6 . . 
        . 6 6 6 6 6 . . 
        . 6 . . . . . . 
        . 6 . . . . . . 
        `],
    200,
    character.rule(Predicate.MovingLeft)
    )
    character.loopFrames(
    sprite,
    [img`
        . 8 8 8 8 8 . . 
        8 8 8 8 8 8 8 . 
        . f 6 f 6 6 . . 
        . 6 6 6 6 6 . . 
        . 6 6 f 6 6 . . 
        . 6 6 6 6 6 . . 
        . 6 . . . 6 . . 
        . 6 . . . 6 . . 
        `],
    200,
    character.rule(Predicate.NotMoving, Predicate.FacingLeft)
    )
    character.loopFrames(
    sprite,
    [img`
        . 8 8 8 8 8 . . 
        8 8 8 8 8 8 8 . 
        . 6 6 f 6 f . . 
        . 6 6 6 6 6 . . 
        . 6 6 f 6 6 . . 
        . 6 6 6 6 6 . . 
        . 6 . . . . . . 
        . 6 . . . . . . 
        `,img`
        . 8 8 8 8 8 . . 
        8 8 8 8 8 8 8 . 
        . 6 6 f 6 f . . 
        . 6 6 6 6 6 . . 
        . 6 6 f 6 6 . . 
        . 6 6 6 6 6 . . 
        . . . . . 6 . . 
        . . . . . 6 . . 
        `],
    200,
    character.rule(Predicate.MovingRight)
    )
    character.loopFrames(
    sprite,
    [img`
        . 8 8 8 8 8 . . 
        8 8 8 8 8 8 8 . 
        . 6 6 f 6 f . . 
        . 6 6 6 6 6 . . 
        . 6 6 f 6 6 . . 
        . 6 6 6 6 6 . . 
        . 6 . . . 6 . . 
        . 6 . . . 6 . . 
        `],
    200,
    character.rule(Predicate.NotMoving, Predicate.FacingRight)
    )
    character.loopFrames(
    sprite,
    [img`
        . 8 8 8 8 8 . . 
        8 8 8 8 8 8 8 . 
        . 6 f 6 f 6 . . 
        . 6 6 6 6 6 . . 
        . 6 6 f 6 6 . . 
        . 6 6 6 6 6 . . 
        . 6 . . . 6 . . 
        . 6 . . . 6 . . 
        `],
    200,
    character.rule(Predicate.MovingUp)
    )
    character.loopFrames(
    sprite,
    [img`
        . 8 8 8 8 8 . . 
        8 8 8 8 8 8 8 . 
        . 6 6 6 6 6 . . 
        . 6 f 6 f 6 . . 
        . 6 6 6 6 6 . . 
        . 6 6 f 6 6 . . 
        . 6 . . . 6 . . 
        . 6 . . . 6 . . 
        `],
    200,
    character.rule(Predicate.MovingDown)
    )
}
let local_random = 0
let sprite_player: Sprite = null
let jumps_made = 0
let constants_jumps_max = 0
let constants_gravity = 0
constants_gravity = 400
constants_jumps_max = 2
jumps_made = 0
sprite_player = sprites.create(img`
    . 8 8 8 8 8 . . 
    8 8 8 8 8 8 8 . 
    . 6 f 6 f 6 . . 
    . 6 6 6 6 6 . . 
    . 6 6 f 6 6 . . 
    . 6 6 6 6 6 . . 
    . 6 . . . 6 . . 
    . 6 . . . 6 . . 
    `, SpriteKind.Player)
animate_player(sprite_player)
controller.moveSprite(sprite_player, 100, 0)
sprite_player.ay = constants_gravity
tiles.setSmallTilemap(tiles.createTilemap(hex`14003c00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000101010101010101010101010101010101010101`, img`
    ....................
    ....................
    ....................
    ....................
    ....................
    ....................
    ....................
    ....................
    ....................
    ....................
    ....................
    ....................
    ....................
    ....................
    ....................
    ....................
    ....................
    ....................
    ....................
    ....................
    ....................
    ....................
    ....................
    ....................
    ....................
    ....................
    ....................
    ....................
    ....................
    ....................
    ....................
    ....................
    ....................
    ....................
    ....................
    ....................
    ....................
    ....................
    ....................
    ....................
    ....................
    ....................
    ....................
    ....................
    ....................
    ....................
    ....................
    ....................
    ....................
    ....................
    ....................
    ....................
    ....................
    ....................
    ....................
    ....................
    ....................
    ....................
    ....................
    22222222222222222222
    `, [myTiles.transparency8,myTiles.tile1], TileScale.Eight))
scene.setBackgroundColor(9)
scene.cameraFollowSprite(sprite_player)
tiles.placeOnTile(sprite_player, tiles.getTileLocation(1, 58))
make_map(3, 5, 5)
